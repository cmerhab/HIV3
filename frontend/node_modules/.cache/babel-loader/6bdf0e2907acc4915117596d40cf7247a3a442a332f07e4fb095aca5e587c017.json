{"ast":null,"code":"import React,{useState,useEffect}from'react';import{UserAuth}from'../context/AuthContext';import ReactSearchBox from\"react-search-box\";import DemoteAdmin from'../components/demoteadmin';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DemoteUser=()=>{const[guestdata,setGuestData]=useState([]);const[guestselect,setGuestSelect]=useState();const[guestbutton,setGuestbutton]=useState(false);const{user}=UserAuth();const current_user=user.email;const[isuserowner,setIsUserOwner]=useState(false);const fetchGuestEmails=async()=>{try{const response=await fetch('https://hiv3-app-1abe045e0a88.herokuapp.com/fetchrole?roleName=Guest');const[guestRole]=await response.json();if(guestRole){let guestEmails=[];guestRole.Roles.forEach(member=>{for(let i=0;i<member.Emails.length;i++){const email=member.Emails[i];const userid=member.Userid[i];guestEmails.push({key:userid,value:email});}});setGuestData(guestEmails);console.log(guestEmails);}}catch(error){console.error('Failed to fetch guest list',error);}};const handleSelect=record=>{setGuestSelect(record);setGuestbutton(true);};const handleBanUser=async()=>{if(!guestselect)return;const userId=guestselect.item.key;const userEmail=guestselect.item.value;try{const response=await fetch('https://hiv3-app-1abe045e0a88.herokuapp.com/banuser',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({userId,userEmail})});const data=await response.json();console.log(data.message);}catch(error){console.error('Failed to ban user',error);}setGuestbutton(false);};const checkMembersInRole=(role,userEmail)=>{return fetch(\"https://hiv3-app-1abe045e0a88.herokuapp.com/findmember?role=\".concat(encodeURIComponent(role),\"&current_user=\").concat(encodeURIComponent(userEmail))).then(response=>response.json()).then(data=>{console.log(data.message);return data.message.includes(\"Member exists in role\");}).catch(error=>{console.error('Error',error);return false;});};const fetchOwnerRole=async()=>{try{const isOwner=await checkMembersInRole('Owner',current_user);if(isOwner){setIsUserOwner(true);}else{console.log(\"The user is not any role yet\");}}catch(error){console.error(\"Error Fetching DA Role\",error);}};useEffect(()=>{fetchGuestEmails();fetchOwnerRole();});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"p\",{children:\"Guest Users\"}),/*#__PURE__*/_jsx(ReactSearchBox,{placeholder:\"Demote User\",value:\"Doe\",data:guestdata,onSelect:handleSelect}),guestselect&&guestbutton&&/*#__PURE__*/_jsxs(\"div\",{className:\"demote\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Ban \",guestselect.item.value,\"?\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleBanUser,children:\"Ban User\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setGuestbutton(false),children:\"No\"})]}),isuserowner&&/*#__PURE__*/_jsx(DemoteAdmin,{})]});};export default DemoteUser;","map":{"version":3,"names":["React","useState","useEffect","UserAuth","ReactSearchBox","DemoteAdmin","jsx","_jsx","jsxs","_jsxs","DemoteUser","guestdata","setGuestData","guestselect","setGuestSelect","guestbutton","setGuestbutton","user","current_user","email","isuserowner","setIsUserOwner","fetchGuestEmails","response","fetch","guestRole","json","guestEmails","Roles","forEach","member","i","Emails","length","userid","Userid","push","key","value","console","log","error","handleSelect","record","handleBanUser","userId","item","userEmail","method","headers","body","JSON","stringify","data","message","checkMembersInRole","role","concat","encodeURIComponent","then","includes","catch","fetchOwnerRole","isOwner","children","placeholder","onSelect","className","onClick"],"sources":["/Users/cmerhab/Desktop/React/Hiv3/frontend/src/components/demoteuser.js"],"sourcesContent":["import React, {useState, useEffect} from 'react';\nimport {UserAuth} from '../context/AuthContext';\nimport ReactSearchBox from \"react-search-box\";\nimport DemoteAdmin from '../components/demoteadmin';\nconst DemoteUser = () => {\n    const [guestdata, setGuestData] = useState([]);\n    const [guestselect, setGuestSelect] = useState();\n    const [guestbutton, setGuestbutton] = useState(false);\n\n    const {user} = UserAuth();\n    const current_user = user.email;\n    const [isuserowner, setIsUserOwner] = useState(false);\n    \n    const fetchGuestEmails = async () => {\n        try {\n            const response = await fetch('https://hiv3-app-1abe045e0a88.herokuapp.com/fetchrole?roleName=Guest');\n            const [guestRole] = await response.json();\n            if(guestRole)\n            {\n                let guestEmails =[];\n                guestRole.Roles.forEach(member => {\n                    for(let i = 0; i< member.Emails.length; i++) {\n                        const email = member.Emails[i];\n                        const userid = member.Userid[i]; \n                        guestEmails.push ({\n                            key: userid,\n                            value: email,\n                        });\n                    }\n                });\n                    \n                setGuestData(guestEmails);\n                console.log(guestEmails);\n            }\n        } catch (error) {\n            console.error('Failed to fetch guest list', error);\n        }\n    };\n\n    const handleSelect = (record) => {\n        setGuestSelect(record);\n        setGuestbutton(true);\n    }\n\n    const handleBanUser = async () => {\n        if(!guestselect)\n            return;\n       const userId = guestselect.item.key;\n        const userEmail = guestselect.item.value;\n        \n\n        try {\n            const response = await fetch('https://hiv3-app-1abe045e0a88.herokuapp.com/banuser', {\n                method: 'PATCH',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({ userId, userEmail }),\n            });\n\n            const data = await response.json();\n            console.log(data.message);\n\n        } catch (error) {\n            console.error('Failed to ban user', error);\n        }\n\n     \n        setGuestbutton(false);\n    }\n\n    const checkMembersInRole = (role, userEmail)  => {\n       return fetch(`https://hiv3-app-1abe045e0a88.herokuapp.com/findmember?role=${encodeURIComponent(role)}&current_user=${encodeURIComponent(userEmail)}`)\n            .then(response => response.json())\n            .then(data=> {\n                console.log(data.message);\n                return data.message.includes(\"Member exists in role\");\n            })\n            .catch(error => {\n                console.error('Error', error);\n                return false;\n            });\n    }\n\n    const fetchOwnerRole = async () => {\n        \n        try {\n            const isOwner = await checkMembersInRole('Owner', current_user);\n            if(isOwner) {\n                setIsUserOwner(true);\n            }\n            else {\n                console.log(\"The user is not any role yet\")\n            }\n        } catch (error) {\n            console.error(\"Error Fetching DA Role\", error);\n        }\n    }\n\n\n\n    useEffect(() => {\n        fetchGuestEmails();\n        fetchOwnerRole();\n    })\n\n   \n    return(\n        <div>\n            <br />\n            <p>Guest Users</p>\n            <ReactSearchBox\n                placeholder='Demote User'\n                value = \"Doe\"\n                data = {guestdata}\n                onSelect={handleSelect}\n\n            />\n            {guestselect && guestbutton && (\n                <div className=\"demote\">\n                    <p>Ban {guestselect.item.value}?</p> \n                    <button onClick={handleBanUser}>Ban User</button>\n                    <button onClick={()=>setGuestbutton(false)}>No</button>\n                </div>\n            )}\n            {isuserowner && (\n                  <DemoteAdmin />\n            )}         \n        </div>\n    )\n};\n\nexport default DemoteUser;\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}